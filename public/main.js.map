{"version":3,"sources":["app/audio.js","app/controllers/device_controller.js","app/device.js","app/main.js","app/midi_access.js","app/midi_message.js","app/reverb.js","app/voice.js"],"names":[],"mappings":"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","file":"public/main.js","sourcesContent":["'use strict';\n\nimport Voice        from 'voice';\nimport midi         from 'midi_message';\n\nconst Ctx = (window.AudioContext || window.webkitAudioContext);\nconst ctx = new Ctx();\nconst voices = {};\n\nfunction stop(note) {\n  const voice = voices[note];\n  delete voices[note];\n  voice.stop();\n}\n\nfunction play(note) {\n  if (voices[note]) { return console.log(`Already playing ${note}`); }\n  const hz = midi.noteToHz(note);\n  const voice = new Voice(ctx, ctx.destination);\n  voice.play(hz);\n  voices[note] = voice;\n}\n\nexport default { play, stop };\n","'use strict';\n\nimport audio from 'audio';\n\nconst TYPE_ON  = 144;\nconst TYPE_OFF = 128;\n\nfunction onMessage(msg) {\n  const data = msg.data;\n  const type = data[0] & 0xf0;\n  // const channel = data[0] & 0xf;\n\n  if (type === TYPE_ON) {\n    audio.play(data[1]);\n  } else if (type === TYPE_OFF) {\n    audio.stop(data[1]);\n  }\n}\n\nexport default { onMessage };\n","'use strict';\n\nimport midiAccess from './midi_access';\n\nconst device = {};\n\nfunction registerRISE(controller, input, output) {\n  if (input && output) {\n    device.input  = input;\n    device.output = output;\n    input.onmidimessage = controller.onMessage;\n    console.log('Registered RISE');\n  } else {\n    throw 'ERROR: Launchpad MIDI device not found';\n  }\n}\n\nfunction initDevice(controller) {\n  midiAccess.getDevice(\n    (i, o) => registerRISE(controller, i, o),\n    /^Seaboard RISE$/\n  );\n}\n\nexport default initDevice;\n","'use strict';\n\nimport initDevice from 'device';\n\nimport deviceController from 'controllers/device_controller';\n\ninitDevice(deviceController);\n\nexport default () => console.log('Hello, world');\n","'use strict';\n\nfunction findDevice(devices, nameRegex) {\n  var result = devices.next();\n  while (!result.done) {\n    if (nameRegex.test(result.value.name)) { return result.value; }\n    result = devices.next();\n  }\n}\n\n// Callback gets the input and output as arguments\n// Name should be a regex\n//\nfunction getDevice(cb, nameRegex) {\n  navigator.requestMIDIAccess().then(\n    (midiAccess) => {\n      const inputs  = midiAccess.inputs.values();\n      const outputs = midiAccess.outputs.values();\n      const input   = findDevice(inputs, nameRegex);\n      const output  = findDevice(outputs, nameRegex);\n      cb(input, output);\n    },\n    ( ) => { throw new Error('Failed to get midi access.'); }\n  );\n\n}\n\nexport default { getDevice };\n","'use strict';\n\nfunction noteToHz(note) {\n  return 440.0 * Math.pow(2, (note - 69.0) / 12.0);\n}\n\nfunction msgToHz(msg) {\n  return noteToHz(msg.data[1]);\n}\n\nexport default { noteToHz, msgToHz };\n","'use strict';\n\nfunction impulseResponse(ctx, duration, decay) {\n  const sampleRate = ctx.sampleRate;\n  const length = sampleRate * duration;\n  const impulse = ctx.createBuffer(2, length, sampleRate);\n  const impulseL = impulse.getChannelData(0);\n  const impulseR = impulse.getChannelData(1);\n\n  if (!decay) { decay = 2.0; }\n  for (var i = 0; i < length; i++){\n    impulseL[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, decay);\n    impulseR[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, decay);\n  }\n  return impulse;\n}\n\nfunction createReverb(ctx) {\n  const convolver  = ctx.createConvolver();\n  convolver.buffer = impulseResponse(ctx, 0.5, 8, false);\n  return convolver;\n}\n\nexport default createReverb;\n","'use strict';\n\nconst attackTime  = 0.05;\nconst releaseTime = 0.2;\n\nexport default class Voice {\n  constructor(ctx, out) {\n    const oscNode  = ctx.createOscillator();\n    const gainNode = ctx.createGain();\n\n    oscNode.type = 'triangle';\n    oscNode.connect(gainNode);\n    gainNode.connect(out);\n\n    this.oscNode = oscNode;\n    this.freqObj = oscNode.frequency;\n    this.gainObj = gainNode.gain;\n    this.ctx = ctx;\n  }\n\n  play(hz) {\n    this.freqObj.value = hz;\n    const now = this.ctx.currentTime;\n    this.oscNode.start();\n    this.gainObj.cancelScheduledValues(now);\n    this.gainObj.setValueAtTime(0, now);\n    this.gainObj.linearRampToValueAtTime(0.5, now + attackTime);\n  }\n  stop() {\n    const now = this.ctx.currentTime;\n    this.gainObj.cancelScheduledValues(now);\n    this.gainObj.setValueAtTime(this.gainObj.value, now);\n    this.gainObj.linearRampToValueAtTime(0, now + releaseTime);\n    setTimeout(\n      () => { console.log('hi');this.oscNode.stop(); },\n      1000 * releaseTime * 2\n    );\n  }\n\n}\n\n"]}