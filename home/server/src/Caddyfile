{
	order cgi before respond
	https_port 4443 # tailscale provides HTTPS on 443
}

(cors) {
	header {
		access-control-allow-origin {args[0]}
	}
}

# Accessible from anywhere
http://cubone, http://localhost, http://cubone.little-grue.ts.net {
	# Print all information about the request
	handle /debug/* {
		cgi * /usr/lib/cgi-bin/debug {
			script_name /debug/
		}
	}

	# A hit counter!
	handle /counter/* {
		import cors *
		cgi * /usr/lib/cgi-bin/counter-increment {
			script_name /counter/
		}
	}

	# Read the counters
	handle /counters {
		cgi * /usr/lib/cgi-bin/counter-read {
			script_name /counters
		}
	}

	# Gatus status monitor
	handle {
		reverse_proxy localhost:3002
	}
}
